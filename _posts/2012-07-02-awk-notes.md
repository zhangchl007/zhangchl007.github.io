---
layout: post
title: Awk usage tips
tag: shell
---

<pre><code>
awk '{system("mv "$2".passwd.txt "$1".passwd.txt")}' 1.txt ##rename

awk '{system("date -d \"1970-01-01 11406843766 sec GMT\"");print $0}' 1.txt ##adjust time

top -b -n 1  | awk -F'[:,]' '/^Cpu/{sub("\..*","",$2); print $2}' ###system cpu usage

Apach log (foward information)

awk '{print $1} ' accesslog | uniq -c | sort -nr | head 10

awk -F' ' '{a[$1]++;}END{for(i in a){print a[i],i | "sort -r -n -k1";}}' 

1、查看当天有多少个IP访问：

awk '{print $1}' log_file|sort|uniq|wc -l

2、查看某一个页面被访问的次数：

grep "/index.php" log_file | wc -l

3、查看每一个IP访问了多少个页面：

awk '{++S[$1]} END {for (a in S) print a,S[a]}' log_file

4、将每个IP访问的页面数进行从小到大排序：

awk '{++S[$1]} END {for (a in S) print S[a],a}' log_file | sort -n

5、查看某一个IP访问了哪些页面：

grep ^111.111.111.111 log_file| awk '{print $1,$7}'

6、去掉搜索引擎统计当天的页面：

awk '{print $12,$1}' log_file | grep ^\"Mozilla | awk '{print $2}' |sort | uniq | wc -l

7、查看2009年6月21日14时这一个小时内有多少IP访问:

awk '{print $4,$1}' log_file | grep 21/Jun/2009:14 | awk '{print $2}'| sort | uniq | wc -l

</pre></code>
